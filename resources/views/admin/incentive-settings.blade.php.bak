@extends('layouts.admin')

@section('content')

<div class="col-xl-12 col-lg-12">
    <!-- Bar Chart -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">INCENTIVES SETTINGS</h6>
        </div>
        <div class="card-body">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <strong><a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Gadget</a></strong>
                    <strong><a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Travel</a></strong>
                    <strong><a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Car</a></strong>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <br>
                <!-- PHONE INCENTIVES -->
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">

                    <table id="gadget_incentives" class="table table-striped table-bordered dt-responsive nowrap" style="width:100%">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>DRP</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>

                            @foreach($all_gadget_incentives as $key => $data)
                            <tr>
                                <td>{{ $data->image }}</td>
                                <td>{{ $data->name }} </td>
                                <td>{{ $data->drp }}</td>
                                <td> <button type="button" class="btn btn-success btn-sm">Update</button> <button type="button" class="btn btn-warning btn-sm">Delete</button> </td>
                            </tr>
                            @endforeach
                        </tbody>
                    </table>

                    <!-- Trigger the modal with a button -->
                    <button type="button" class="btn btn-primary btn-xs" id="createNewProduct" data-toggle="modal" data-target="#myModal">Add New Gadget</button>

                    <!-- Modal -->
                    <div class="modal fade" id="ajaxGadgetModel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title" id="modelHeading"></h4>
                                </div>
                                <div class="modal-body">
                                    <form id="productForm" name="productForm" class="form-horizontal">
                                        <input type="hidden" name="gadget_id" id="gadget_id">
                                        <div class="form-group">
                                            <label for="name" class="col-sm-2 control-label">Name</label>
                                            <div class="col-sm-12">
                                                <input type="text" class="form-control" id="name" name="name" placeholder="Enter Name" value="" maxlength="50" required="">
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">Details</label>
                                            <div class="col-sm-12">
                                                <textarea id="detail" name="detail" required="" placeholder="Enter Details" class="form-control"></textarea>
                                            </div>
                                        </div>

                                        <div class="col-sm-offset-2 col-sm-10">
                                            <button type="submit" class="btn btn-primary" id="saveBtn" value="create">Save changes
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>




                </div>

                <br>
                <!-- TRAVEL INCENTIVES -->
                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">


                </div>

                <br>
                <!-- CAR INCENTIVES -->
                <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">

                </div>
            </div>


        </div>
    </div>
</div>
<script>
// Add the following code if you want the name of the file appear on select
    $(".custom-file-input").on("change", function () {
        var fileName = $(this).val().split("\\").pop();
        $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {

        $('#gadget_incentives').DataTable({
            responsive: true
        });

        $('#travel_incentives').DataTable({
            responsive: true
        });

        $('#car_incentives').DataTable({
            responsive: true
        });



        $('#createNewProduct').click(function () {
            $('#saveBtn').val("create-gadget");
            $('#gadget_id').val('');
            $('#productForm').trigger("reset");
            $('#modelHeading').html("Create New Gadget");
            $('#ajaxGadgetModel').show();
        });

        $('body').on('click', '.editProduct', function () {
            var gadget_id = $(this).data('id');
            $.get("{{ route('incentive-settings') }}" + '/' + gadget_id + '/edit', function (data) {
                $('#modelHeading').html("Edit Product");
                $('#saveBtn').val("edit-user");
                $('#ajaxModel').modal('show');
                $('#gadget_id').val(data.id);
                $('#name').val(data.name);
                $('#detail').val(data.detail);
            })
        });





        $('#btn-add-gadget').click(function () {
            $('#btn-save-gadget').val("add");
            $('#modalFormData-gadget').trigger("reset");
            $('#linkEditorModal-gadget').show();

            ////----- Open the modal to UPDATE a link -----////
            $('body').on('click', '.open-modal', function () {
                var gadget_id = $(this).val();
                $.get('admin/gadget/' + gadget_id, function (data) {
                    $('#gadget_id').val(data.id);
                    $('#name').val(data.name);
                    $('#drp').val(data.drp);
                    $('#image').val(data.image);
                    $('#btn-save-gadget').val("update");
                    $('#linkEditorModal-gadget').modal('show');
                })
            });

        });


        // Clicking the save button on the open modal for both CREATE and UPDATE
        $("#btn-save-gadget").click(function (e) {
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': jQuery('meta[name="csrf-token"]').attr('content')
                }
            });
            e.preventDefault();
            var formData = {
                name: jQuery('#name').val(),
                drp: jQuery('#drp').val(),
                image: jQuery('#image').val(),
            };
            var state = jQuery('#btn-save-gadget').val();
            var type = "POST";
            var gadget_id = jQuery('#gadget_id').val();
            var ajaxurl = 'gadget';
            if (state == "update") {
                type = "PUT";
                ajaxurl = 'gadget/' + gadget_id;
            }

            $.ajax({
                type: type,
                url: ajaxurl,
                data: formData,
                dataType: 'json',
                success: function (data) {
                    jQuery('#modalFormData-gadget').trigger("reset");
                    jQuery('#linkEditorModal-gadget').modal('hide');
                },
                error: function (data) {
                    console.log('Error:', data);
                }
            });
        });



    });
</script>
@endsection